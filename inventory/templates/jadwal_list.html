{% extends 'base_lte.html' %}
{% block page_title %}Daftar Jadwal Preventive{% endblock %}
{% block content %}

<!-- 1. TOMBOL NAVIGASI & AKSI -->
<div class="row mb-2">
  <div class="col-12">
    <div class="btn-group mb-1 mr-2">
        <a href="{% url 'jadwal_kalender' %}" class="btn btn-info" title="Lihat Kalender Bulanan">
            <i class="fas fa-calendar-alt"></i> Kalender Bulanan
        </a>
        <a href="{% url 'jadwal_kalender_tahunan' %}" class="btn btn-primary" title="Lihat Kalender 1 Tahun">
            <i class="fas fa-calendar"></i> Kalender Tahunan
        </a>
    </div>

    <a href="{% url 'tambah_jadwal' %}" class="btn btn-success">
      <i class="fas fa-plus"></i> Tambah Jadwal Baru
    </a>
    
    <a href="{% url 'dashboard' %}" class="btn btn-default">
        <i class="fas fa-arrow-left"></i> Kembali ke Dashboard
    </a>
  </div>
</div>

<!-- 2. STATISTIK RINGKAS (DI DALAM LIST) -->
<div class="row mb-2">
    <div class="col-12">
        <div class="alert alert-secondary p-2">
            <i class="fas fa-info-circle"></i> Total Jadwal: <b>{{ total_jadwal }}</b> | 
            <span class="badge badge-warning text-white">Pending: {{ pending_count }}</span> | 
            <span class="badge badge-success">Selesai: {{ done_count }}</span>
        </div>
    </div>
</div>

<!-- 3. TABEL DATA JADWAL -->
<div class="card card-primary card-outline">
  <div class="card-header">
    <h3 class="card-title">Riwayat Jadwal Preventive</h3>
    <div class="card-tools">
        <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
    </div>
  </div>
  <div class="card-body p-0">
    <table class="table table-striped projects">
      <thead>
        <tr>
          <th style="width: 15%">Tanggal</th>
          <th>Mesin</th>
          <th>Keterangan Pekerjaan</th>
          <th style="width: 15%">Teknisi</th>
          <th style="width: 10%">Status</th>
          <th style="width: 15%">Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for jadwal in jadwal_list %}
        <tr>
          <td>
            <i class="far fa-calendar mr-1"></i> {{ jadwal.tgl_jadwal|date:"d M Y" }}
          </td>
          <td>
            <a href="#" class="font-weight-bold text-dark">{{ jadwal.machine.name }}</a>
            <br>
            <small class="text-muted">Kode: {{ jadwal.machine.code }}</small>
          </td>
          <td>{{ jadwal.keterangan }}</td>
          <td>
            {% if jadwal.teknisi %}
                <span class="badge badge-light border text-dark"><i class="fas fa-user"></i> {{ jadwal.teknisi }}</span>
            {% else %}
                <span class="text-muted">-</span>
            {% endif %}
          </td>
          <td>
            {% if jadwal.status == 'Pending' %}
                <span class="badge badge-warning">Pending</span>
            {% else %}
                <span class="badge badge-success">Selesai</span>
            {% endif %}
          </td>
          <td>
            <div class="btn-group btn-group-sm">
              <a href="{% url 'jadwal_edit' jadwal.pk %}" class="btn btn-info" title="Edit">
                <i class="fas fa-pencil-alt"></i>
              </a>
              <a href="{% url 'jadwal_delete' jadwal.pk %}" class="btn btn-danger" title="Hapus" onclick="return confirm('Yakin ingin menghapus jadwal ini?')">
                <i class="fas fa-trash"></i>
              </a>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center py-4">
              <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
              <br>
              Belum ada data jadwal preventive. Silakan buat jadwal baru.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}